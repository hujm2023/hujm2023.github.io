<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>最小堆以及优先级队列的Golang实现 | hujm2023&#39;s blog</title>
<meta name="keywords" content="Golang, 最小堆, 优先级队列">
<meta name="description" content="前言
堆，是计算机科学中的一种特别的完全二叉树。若父节点的值恒小于等于子节点的值，此堆称为最小堆（min heap）；反之，若母节点的值恒大于等于子节点的值，此堆称为最大堆（max heap）。在堆中最顶端的那一个节点，称作 根节点（root node），根节点本身没有 父节点（parent node）。堆通常是一个可以被看做一棵树的数组对象。在队列中，调度程序反复提取队列中第一个作业并运行，因为实际情况中某些时间较短的任务将等待很长时间才能结束，或者某些不短小，但具有重要性的作业，同样应当具有优先权。堆即为解决此类问题设计的一种数据结构。">
<meta name="author" content="JemmyHu(hujm20151021@gmail.com)">
<link rel="canonical" href="http://localhost:1313/posts/%E6%9C%80%E5%B0%8F%E5%A0%86%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97%E7%9A%84golang%E5%AE%9E%E7%8E%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css" integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn&#43;yY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/%E6%9C%80%E5%B0%8F%E5%A0%86%E4%BB%A5%E5%8F%8A%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97%E7%9A%84golang%E5%AE%9E%E7%8E%B0/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="hujm2023&#39;s blog (Alt + H)">hujm2023&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      最小堆以及优先级队列的Golang实现
    </h1>
    <div class="post-meta"><span title='2021-05-13 21:08:09 +0800 CST'>May 13, 2021</span>&nbsp;·&nbsp;<span>JemmyHu(hujm20151021@gmail.com)</span>

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="https://pic.downk.cc/item/5f77e088160a154a67ede68f.png" alt="">
        
</figure>
  <div class="post-content"><h2 id="前言">前言<a hidden class="anchor" aria-hidden="true" href="#前言">#</a></h2>
<p><a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E7%A9%8D">堆</a>，是计算机科学中的一种特别的完全二叉树。若父节点的值恒小于等于子节点的值，此堆称为<strong>最小堆（min heap）</strong>；反之，若母节点的值恒大于等于子节点的值，此堆称为<strong>最大堆（max heap）</strong>。在堆中最顶端的那一个节点，称作 <strong>根节点（root node）</strong>，根节点本身没有 <strong>父节点（parent node）</strong>。堆通常是一个可以被看做一棵树的数组对象。在队列中，调度程序反复提取队列中第一个作业并运行，因为实际情况中某些时间较短的任务将等待很长时间才能结束，或者某些不短小，但具有重要性的作业，同样应当具有优先权。堆即为解决此类问题设计的一种数据结构。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%84%AA%E5%85%88%E4%BD%87%E5%88%97">优先级队列</a> 是计算机科学中的一类抽象数据类型。优先队列中的每个元素都有各自的优先级，优先级最高的元素最先得到服务；优先级相同的元素按照其在优先队列中的顺序得到服务。<strong>优先队列往往用堆来实现</strong>。</p>
<h2 id="golang实现一根据原理简单实现"><code>Golang</code>实现一：根据原理简单实现<a hidden class="anchor" aria-hidden="true" href="#golang实现一根据原理简单实现">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">minheap</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;container/heap&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;math&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;github.com/pkg/errors&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @CreateTime: 2021/7/6 21:57
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @Author: hujiaming
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @Description: Golang实现最小堆
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ErrMinHeapEmpty</span> = <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;minHeap is empty&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">HeapHeadTag</span> <span style="color:#66d9ef">int64</span> = <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">MinInt64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MinHeap</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">elements</span> []<span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// NewMinHeap 创建一个最小堆实例</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewMinHeap</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">MinHeap</span>{<span style="color:#a6e22e">elements</span>: []<span style="color:#66d9ef">int64</span>{<span style="color:#a6e22e">HeapHeadTag</span>}}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">Add 将一个元素添加到最小堆中，并且添加后要使其满足最小堆的特性
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">首先将该元素插入到数组最后，然后对这最后一个元素进行 “上浮” 操作：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">该元素与父元素进行大小比较，如果小于父元素，则和父元素交换位置，如此循环，直到 到达堆顶 或 子元素小于父元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">v</span> <span style="color:#66d9ef">int64</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. 先将元素插在数组最后面</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span> = append(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>, <span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. 将最后一个元素上浮，使其符合最小堆的性质。其实是为 v 找位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ; <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] &gt; <span style="color:#a6e22e">v</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">v</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">PopMin 弹出堆中最小的元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">对最小堆而言，移除元素，只能移除堆顶(最小值)的元素。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">首先，移除堆顶元素，然后将最后一个元素放在堆顶，之后对这第一个元素进行 “下沉” 操作：
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">将此元素与两个子节点元素比较，如果当前结点大于两个子节点，则与较小的子节点交换位置，如此循环，直到 到达叶子结点 或 小于较小子节点。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">PopMin</span>() (<span style="color:#66d9ef">int64</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">IsEmpty</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ErrMinHeapEmpty</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">res</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">last</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// idx 表示最后一个元素应该在的位置</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">idx</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">idx</span> = <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">idx</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> &lt; len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>); {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 找出子节点中较小的元素的 index</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">minChildIdx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">idx</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">minChildIdx</span> &lt; len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">minChildIdx</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] &lt; <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">minChildIdx</span>] {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">minChildIdx</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 当前结点 大于 较小子节点，和这个较小子节点交换位置，继续循环</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">last</span> &gt; <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">minChildIdx</span>] {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">idx</span>] = <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">minChildIdx</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">idx</span> = <span style="color:#a6e22e">minChildIdx</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#a6e22e">idx</span>] = <span style="color:#a6e22e">last</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span> = <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[:len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// PeekHead 只返回堆顶元素(最小值)，不进行下沉操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">PeekHead</span>() (<span style="color:#66d9ef">int64</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">IsEmpty</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">ErrMinHeapEmpty</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">1</span>], <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// IsEmpty 最小堆是否是空的</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">IsEmpty</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> (len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">HeapHeadTag</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Length 返回最小堆中的元素个数</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">Length</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> len(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Print 打印代表最小堆的数组</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MinHeap</span>) <span style="color:#a6e22e">Print</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">elements</span>[<span style="color:#ae81ff">1</span>:])
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Test</code> 如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestMinHeap</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewMinHeap</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">7</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">9</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Print</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> !<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">IsEmpty</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">PopMin</span>())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">assert</span>.<span style="color:#a6e22e">Equal</span>(<span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">mh</span>.<span style="color:#a6e22e">Length</span>(), <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 输出</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">[1 2 5 2 4 7 10 9 3]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">1 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">2 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">2 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">3 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">4 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">5 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">7 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">9 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">10 &lt;nil&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><h2 id="golang-实现二实现标准库-heapinterface-接口"><code>Golang</code> 实现二：实现标准库 <code>heap.Interface</code> 接口<a hidden class="anchor" aria-hidden="true" href="#golang-实现二实现标准库-heapinterface-接口">#</a></h2>
<p>先看下标准库中的 <code>Interface</code>，位置在 <code>container/heap/heap.go</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// The Interface type describes the requirements</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for a type using the routines in this package.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Any type that implements it may be used as a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// min-heap with the following invariants (established after</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Init has been called or if the data is empty or sorted):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// !h.Less(j, i) for 0 &lt;= i &lt; h.Len() and 2*i+1 &lt;= j &lt;= 2*i+2 and j &lt; h.Len()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Note that Push and Pop in this interface are for package heap&#39;s</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// implementation to call. To add and remove things from the heap,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// use heap.Push and heap.Pop.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Interface</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#75715e">// add x as element Len()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Pop</span>() <span style="color:#66d9ef">interface</span>{}   <span style="color:#75715e">// remove and return element Len() - 1.</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// An implementation of Interface can be sorted by the routines in this package.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The methods refer to elements of the underlying collection by integer index.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Interface</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Len is the number of elements in the collection.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Len</span>() <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Less reports whether the element with index i</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// must sort before the element with index j.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // If both Less(i, j) and Less(j, i) are false,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// then the elements at index i and j are considered equal.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Sort may place equal elements in any order in the final result,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// while Stable preserves the original input order of equal elements.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // Less must describe a transitive ordering:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  - if both Less(i, j) and Less(j, k) are true, then Less(i, k) must be true as well.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  - if both Less(i, j) and Less(j, k) are false, then Less(i, k) must be false as well.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    // Note that floating-point comparison (the &lt; operator on float32 or float64 values)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// is not a transitive ordering when not-a-number (NaN) values are involved.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// See Float64Slice.Less for a correct implementation for floating-point values.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Swap swaps the elements with indexes i and j.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们以此为基础，实现一个 <strong>优先级队列</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">priorityqueen</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Item</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">value</span>    <span style="color:#66d9ef">int64</span> <span style="color:#75715e">// 实际值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span> <span style="color:#66d9ef">int64</span> <span style="color:#75715e">// 优先级</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">index</span>    <span style="color:#66d9ef">int</span>   <span style="color:#75715e">// 当前 item 在数组中的 index</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// PriorityQueen 表示优先级队列</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PriorityQueen</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">Len</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> len(<span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">priority</span> &lt; <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">priority</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">i</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mh2</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">j</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Push 将 x 添加到数组最后</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> len(<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> cap(<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">l</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> &gt; <span style="color:#a6e22e">c</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cmh2</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>, <span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">c</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        copy(<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>, <span style="color:#a6e22e">cmh2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span> = <span style="color:#a6e22e">cmh2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span> = (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[:<span style="color:#a6e22e">l</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> (<span style="color:#a6e22e">x</span>).(<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">l</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[<span style="color:#a6e22e">l</span>] = <span style="color:#a6e22e">item</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Pop 返回数组最后一个元素</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">Pop</span>() <span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> len(<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> cap(<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">l</span> &lt; <span style="color:#a6e22e">c</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">c</span> &gt; <span style="color:#ae81ff">25</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cmh2</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>, <span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">c</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        copy(<span style="color:#a6e22e">cmh2</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span> = <span style="color:#a6e22e">cmh2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[<span style="color:#a6e22e">l</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">index</span> = <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#75715e">// for safety</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span> = (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[:<span style="color:#a6e22e">l</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// PopHead 弹出堆顶元素</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">PopHead</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">mh2</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">heap</span>.<span style="color:#a6e22e">Remove</span>(<span style="color:#a6e22e">mh2</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// PopWithPriority 弹出优先级小于 maxP 的堆顶元素，如果没有，返回 nil 和 当前堆顶和maxP的距离</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">PopWithPriority</span>(<span style="color:#a6e22e">maxP</span> <span style="color:#66d9ef">int64</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>, <span style="color:#66d9ef">int64</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">mh2</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">priority</span> &gt; <span style="color:#a6e22e">maxP</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">priority</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">maxP</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">heap</span>.<span style="color:#a6e22e">Remove</span>(<span style="color:#a6e22e">mh2</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// PeekHead 显示堆顶元素</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">mh2</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PriorityQueen</span>) <span style="color:#a6e22e">PeekHead</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">mh2</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">heap</span>.<span style="color:#a6e22e">Init</span>(<span style="color:#a6e22e">mh2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">mh2</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>测试一下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestPriorityQueen</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">items</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Item</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Int63n</span>(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">items</span> = append(<span style="color:#a6e22e">items</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Item</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">value</span>:    <span style="color:#a6e22e">v</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">priority</span>: <span style="color:#a6e22e">v</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">index</span>:    <span style="color:#a6e22e">i</span>,
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">q</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">PriorityQueen</span>(<span style="color:#a6e22e">items</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">heap</span>.<span style="color:#a6e22e">Init</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">q</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">PeekHead</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">maxP</span> <span style="color:#f92672">:=</span> int64(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">q</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">priority</span> &lt; <span style="color:#a6e22e">maxP</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;p: %d, v: %d&#34;</span>, <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">priority</span>, <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">value</span>))
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;====&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">item</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">PopWithPriority</span>(<span style="color:#a6e22e">maxP</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">item</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;====&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">item</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">PopHead</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">item</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 输出</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{5 5 0}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">p: 5, v: 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">p: 11, v: 11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">p: 6, v: 6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">p: 33, v: 33
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{5 5 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{6 6 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{11 11 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{33 33 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{50 50 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{52 52 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{73 73 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{85 85 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{97 97 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&amp;{99 99 -1}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><h2 id="golang-标准库-heapinterface-源码解析">Golang 标准库 <code>heap.Interface</code> 源码解析<a hidden class="anchor" aria-hidden="true" href="#golang-标准库-heapinterface-源码解析">#</a></h2>
<p>整个包的实现非常简洁，加上注释以及空行，整个文件才只有120 行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Copyright 2009 The Go Authors. All rights reserved.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Use of this source code is governed by a BSD-style</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// license that can be found in the LICENSE file.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Package heap provides heap operations for any type that implements</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// heap.Interface. A heap is a tree with the property that each node is the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// minimum-valued node in its subtree.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// The minimum element in the tree is the root, at index 0.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// A heap is a common way to implement a priority queue. To build a priority</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// queue, implement the Heap interface with the (negative) priority as the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ordering for the Less method, so Push adds items while Pop removes the</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// highest-priority item from the queue. The Examples include such an</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// implementation; the file example_pq_test.go has the complete source.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">package heap</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;sort&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The Interface type describes the requirements</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// for a type using the routines in this package.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Any type that implements it may be used as a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// min-heap with the following invariants (established after</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Init has been called or if the data is empty or sorted):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// !h.Less(j, i) for 0 &lt;= i &lt; h.Len() and 2*i+1 &lt;= j &lt;= 2*i+2 and j &lt; h.Len()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Note that Push and Pop in this interface are for package heap&#39;s</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// implementation to call. To add and remove things from the heap,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// use heap.Push and heap.Pop.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Interface</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#75715e">// add x as element Len()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Pop</span>() <span style="color:#66d9ef">interface</span>{}   <span style="color:#75715e">// remove and return element Len() - 1.</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Init establishes the heap invariants required by the other routines in this package.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Init is idempotent with respect to the heap invariants</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// and may be called whenever the heap invariants may have been invalidated.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The complexity is O(n) where n = h.Len().</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Init</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// heapify</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Len</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// (n/2 - 1) 处的结点是最后一棵子树(没有孩子结点)的根节点</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">n</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Push pushes the element x onto the heap.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The complexity is O(log n) where n = h.Len().</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Len</span>()<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Pop removes and returns the minimum element (according to Less) from the heap.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The complexity is O(log n) where n = h.Len().</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Pop is equivalent to Remove(h, 0).</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Pop</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>) <span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Swap</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">h</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Pop</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Remove removes and returns the element at index i from the heap.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The complexity is O(log n) where n = h.Len().</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Remove</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">interface</span>{} {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Len</span>() <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">i</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">n</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Pop</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Fix re-establishes the heap ordering after the element at index i has changed its value.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Changing the value of the element at index i and then calling Fix is equivalent to,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// but less expensive than, calling Remove(h, i) followed by a Push of the new value.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The complexity is O(log n) where n = h.Len().</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Fix</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Len</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">h</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">up</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> (<span style="color:#a6e22e">j</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e">// parent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">||</span> !<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">j</span> = <span style="color:#a6e22e">i</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">down</span>(<span style="color:#a6e22e">h</span> <span style="color:#a6e22e">Interface</span>, <span style="color:#a6e22e">i0</span>, <span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">i0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">j1</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">j1</span> <span style="color:#f92672">&gt;=</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">j1</span> &lt; <span style="color:#ae81ff">0</span> { <span style="color:#75715e">// j1 &lt; 0 after int overflow</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">j1</span> <span style="color:#75715e">// left child</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">j2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">j1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j2</span> &lt; <span style="color:#a6e22e">n</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">j2</span>, <span style="color:#a6e22e">j1</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">j</span> = <span style="color:#a6e22e">j2</span> <span style="color:#75715e">// = 2*i + 2  // right child</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">i</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">i</span> = <span style="color:#a6e22e">j</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">i</span> &gt; <span style="color:#a6e22e">i0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>我们关注其中几个核心实现：</p>
<ul>
<li>
<p><code>down(h Interface, idx, heapLen int)</code> 下沉操作：<br />
首先，移除堆顶元素，然后将最后一个元素放在堆顶，之后对这第一个元素进行 “下沉” 操作：<br />
将此元素与两个子节点元素比较，如果当前结点大于两个子节点，则与较小的子节点交换位置，如此循环，直到 到达叶子结点 或 小于较小子节点。<br />
为什么元素 i 比它的两个子节点都小，就可以跳出循环，不再继续下去呢？这是由于，在 <code>Init</code> 函数中，<strong>第一个开始 <code>down</code> 的元素是第 <code>n/2 - 1</code> 个，可以保证总是从最后一棵子树开始 <code>down</code></strong>，因此可以保证 <code>Init-&gt;down</code> 时，如果元素 <code>i</code> 比它的两个子节点都小，那么该元素对应的子树，就是最小堆。<br />
<img alt="image" loading="lazy" src="https://image.hujm.net/124694449-dc665a00-df13-11eb-8e72-1cbef91adac6.png"></p>
</li>
<li>
<p><code>up(h Interface, curIdx int)</code> 上浮操作：<br />
主要用在 <code>Push</code> 中，当我们向最小堆插入一个元素时，现将其插入到数组最后，之后进行上浮操作，此时的 <code>curIdx</code> 就是数组最后一个元素的 <code>index</code>，即 <code>h.Len() - 1</code>。当前元素与其父元素进行比较，如果当前元素小于父元素，则与父元素交换位置，如此往复，直到堆顶或者当前元素大于父元素。</p>
</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/golang/">Golang</a></li>
      <li><a href="http://localhost:1313/tags/%E6%9C%80%E5%B0%8F%E5%A0%86/">最小堆</a></li>
      <li><a href="http://localhost:1313/tags/%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97/">优先级队列</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">hujm2023&#39;s blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
