<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Golang中使用RSA进行加解密 | hujm2023&#39;s blog</title>
<meta name="keywords" content="Golang, 加密算法, RSA">
<meta name="description" content="
本文对 RSA 加密算法 的细节不做深究，仅描述大致用法。具体算法原理请阅读参考文献中的 2 和 4。
一、介绍
当我们谈论加解密方式时，通常有两种情形：对称加密 和 非对称加密。">
<meta name="author" content="JemmyHu(hujm20151021@gmail.com)">
<link rel="canonical" href="http://localhost:1313/posts/golang%E4%B8%AD%E4%BD%BF%E7%94%A8rsa%E8%BF%9B%E8%A1%8C%E5%8A%A0%E8%A7%A3%E5%AF%86/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css" integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn&#43;yY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/golang%E4%B8%AD%E4%BD%BF%E7%94%A8rsa%E8%BF%9B%E8%A1%8C%E5%8A%A0%E8%A7%A3%E5%AF%86/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="hujm2023&#39;s blog (Alt + H)">hujm2023&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="文章">
                    <span>文章</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Golang中使用RSA进行加解密
    </h1>
    <div class="post-meta"><span title='2021-01-14 11:45:06 +0800 CST'>January 14, 2021</span>&nbsp;·&nbsp;<span>JemmyHu(hujm20151021@gmail.com)</span>

</div>
  </header> 
  <div class="post-content"><!-- @format -->
<p>本文对 RSA 加密算法 的细节不做深究，仅描述大致用法。具体算法原理请阅读参考文献中的 2 和 4。</p>
<h2 id="一介绍">一、介绍<a hidden class="anchor" aria-hidden="true" href="#一介绍">#</a></h2>
<p>当我们谈论加解密方式时，通常有两种情形：<strong>对称加密</strong> 和 <strong>非对称加密</strong>。</p>
<p>对于 <code>对称加密</code>，加密和解密使用同一份秘钥，加密者必须将加密方式告知使用者，否则使用者无法解密，这就面临着 “秘钥配送问题”。</p>
<p>而在 <code>非对称加密</code> 中，有公钥和私钥加密使用公钥，解密使用私钥；公钥是公开的，任何人都可以获得，私钥则是保密的。只有持有私钥的人才能解开被对应公钥加密的数据。因此非对称加密算法，也称公钥加密算法。</p>
<p>如果公钥加密的信息只有私钥解得开，那么只要私钥不泄漏，通信就是安全的。</p>
<p>1977 年，三位数学家 Rivest、Shamir 和 Adleman 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字命名，叫做 <a href="http://zh.wikipedia.org/zh-cn/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><code>RSA算法</code></a>。从那时直到现在，RSA 算法一直是最广为使用的&quot;非对称加密算法&quot;。毫不夸张地说，<strong>只要有计算机网络的地方，就有 RSA 算法</strong>。</p>
<p>这种算法非常<a href="http://en.wikipedia.org/wiki/RSA_Factoring_Challenge">可靠</a>，密钥越长，它就越难破解。根据已经披露的文献，目前被破解的最长 RSA 密钥是 768 个二进制位。也就是说，长度超过 768 位的密钥，还无法破解（至少没人公开宣布）。因此可以认为，1024 位的 RSA 密钥 基本安全，2048 位的密钥极其安全。</p>
<h2 id="二使用">二、使用<a hidden class="anchor" aria-hidden="true" href="#二使用">#</a></h2>
<p>Golang 的标准库中已经对 RSA 相关的加密算法进行了实现，这里展示基本用法 以及 使用自定义密码 的场景。</p>
<p>对 RSA 的使用大致分为三个步骤：</p>
<ol>
<li><code>RSAGenKey</code> 生成公钥和私钥；</li>
<li><code>RSAEncrypt</code> 加密数据，传入 待加密数据 和 公钥，返回 加密后的数据；</li>
<li><code>RSADecrypt</code> 解密数据，传入 被加密的数据 和 私钥，返回 解密后的数据。</li>
</ol>
<h3 id="1-rsa-加密的基本用法">1. RSA 加密的基本用法<a hidden class="anchor" aria-hidden="true" href="#1-rsa-加密的基本用法">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// RSAGenKey 生成公私钥</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RSAGenKey</span>(<span style="color:#a6e22e">bits</span> <span style="color:#66d9ef">int</span>) (<span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		生成私钥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 1、使用RSA中的GenerateKey方法生成私钥（bits=1024基本安全，2048 极其安全）</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">bits</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 2、通过X509标准将得到的RAS私钥序列化为：ASN.1 的DER编码字符串</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateStream</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">privateKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 3、将私钥字符串设置到pem格式块中</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block1</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;private key&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">privateStream</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 4、通过pem将设置的数据进行编码，并写入磁盘文件</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// fPrivate, err := os.Create(&#34;privateKey.pem&#34;)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// if err != nil {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 	return err</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// }</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// defer fPrivate.Close()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// err = pem.Encode(fPrivate, block1)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// if err != nil {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 	return err</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// }</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 4. 有两种方式，一种是将秘钥写入文件，一种是当成返回值返回，由使用者自行决定</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">prvKey</span> = <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">EncodeToMemory</span>(<span style="color:#a6e22e">block1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		生成公钥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicKey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">privateKey</span>.<span style="color:#a6e22e">PublicKey</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicStream</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKIXPublicKey</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">publicKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block2</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;public key&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">publicStream</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// fPublic, err := os.Create(&#34;publicKey.pem&#34;)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// if err != nil {</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 	return err</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// }</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// defer fPublic.Close()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// pem.Encode(fPublic, &amp;block2)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 同样，可以将公钥写入文件，也可以直接返回</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pubKey</span> = <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">EncodeToMemory</span>(<span style="color:#a6e22e">block2</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// RSAEncrypt 对数据进行加密操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RSAEncrypt</span>(<span style="color:#a6e22e">src</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">pubKey</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">res</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">pubKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用X509将解码之后的数据 解析出来</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">keyInit</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ParsePKIXPublicKey</span>(<span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">Bytes</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicKey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">keyInit</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">PublicKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用公钥加密数据</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">EncryptPKCS1v15</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">publicKey</span>, <span style="color:#a6e22e">src</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 对数据进行解密操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RSADecrypt</span>(<span style="color:#a6e22e">src</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">prvKey</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">res</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 解码</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">prvKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">blockBytes</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">Bytes</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ParsePKCS1PrivateKey</span>(<span style="color:#a6e22e">blockBytes</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 还原数据</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">DecryptPKCS1v15</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">src</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>看一个 demo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sourceData</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;我的头发长，天下我为王&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 创建公私钥</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSAGenKey</span>(<span style="color:#ae81ff">2048</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;gen pubKey and prvKey ok!&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;before encrypt: %s\n&#34;</span>, <span style="color:#a6e22e">sourceData</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用公钥加密</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">encryptData</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSAEncrypt</span>([]byte(<span style="color:#a6e22e">sourceData</span>), <span style="color:#a6e22e">pubKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after encrypt: %v\n&#34;</span>, <span style="color:#a6e22e">encryptData</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用私钥解密</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">decryptData</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSADecrypt</span>(<span style="color:#a6e22e">encryptData</span>, <span style="color:#a6e22e">prvKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after decrypt: %s\n&#34;</span>, string(<span style="color:#a6e22e">decryptData</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;equal? %v \n&#34;</span>, string(<span style="color:#a6e22e">decryptData</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">sourceData</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 输出</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gen</span> <span style="color:#a6e22e">pubKey</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">prvKey</span> <span style="color:#a6e22e">ok</span>!
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">before</span> <span style="color:#a6e22e">encrypt</span>: <span style="color:#a6e22e">我的头发长</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">天下我为王</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">after</span> <span style="color:#a6e22e">encrypt</span>: [<span style="color:#ae81ff">153</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">185</span> <span style="color:#ae81ff">195</span> <span style="color:#f92672">...</span>(<span style="color:#a6e22e">很长的字节数组</span>)]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">after</span> <span style="color:#a6e22e">decrypt</span>: <span style="color:#a6e22e">我的头发长</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">天下我为王</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">equal</span><span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><h3 id="2-使用自定义密码的-rsa-算法">2. 使用自定义密码的 RSA 算法<a hidden class="anchor" aria-hidden="true" href="#2-使用自定义密码的-rsa-算法">#</a></h3>
<p>有时候我们想在随机生成的基础上加上自定义的密码，可以使用下面的方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// RSAGenKeyWithPwd generate rsa pair key with specified password</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RSAGenKeyWithPwd</span>(<span style="color:#a6e22e">bits</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">pwd</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		生成私钥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 1、使用RSA中的GenerateKey方法生成私钥</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">GenerateKey</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">bits</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 2、通过X509标准将得到的RAS私钥序列化为：ASN.1 的DER编码字符串</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateStream</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKCS1PrivateKey</span>(<span style="color:#a6e22e">privateKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 3、将私钥字符串设置到pem格式块中</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block1</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;private key&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">privateStream</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 通过自定义密码加密</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">pwd</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">block1</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">EncryptPEMBlock</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">block1</span>.<span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">block1</span>.<span style="color:#a6e22e">Bytes</span>, []byte(<span style="color:#a6e22e">pwd</span>), <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">PEMCipherAES256</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">prvKey</span> = <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">EncodeToMemory</span>(<span style="color:#a6e22e">block1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		生成公钥
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicKey</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">privateKey</span>.<span style="color:#a6e22e">PublicKey</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicStream</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">MarshalPKIXPublicKey</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">publicKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block2</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Block</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Type</span>:  <span style="color:#e6db74">&#34;public key&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Bytes</span>: <span style="color:#a6e22e">publicStream</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pubKey</span> = <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">EncodeToMemory</span>(<span style="color:#a6e22e">block2</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span>, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 加密方式与 RSAEncrypt 没有区别，可以共用</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// RSADecryptWithPwd decrypt src with private key and password</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">RSADecryptWithPwd</span>(<span style="color:#a6e22e">src</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">prvKey</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">pwd</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">res</span> []<span style="color:#66d9ef">byte</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 解码</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">block</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pem</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">prvKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">blockBytes</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">block</span>.<span style="color:#a6e22e">Bytes</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">pwd</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">blockBytes</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">DecryptPEMBlock</span>(<span style="color:#a6e22e">block</span>, []byte(<span style="color:#a6e22e">pwd</span>))
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">x509</span>.<span style="color:#a6e22e">ParsePKCS1PrivateKey</span>(<span style="color:#a6e22e">blockBytes</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 还原数据</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rsa</span>.<span style="color:#a6e22e">DecryptPKCS1v15</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">privateKey</span>, <span style="color:#a6e22e">src</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>看一个 demo：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">sourceData</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;好的代码本身就是最好的说明文档&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pwd</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;123456&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 创建公私钥</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">pubKey</span>, <span style="color:#a6e22e">prvKey</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSAGenKeyWithPwd</span>(<span style="color:#ae81ff">2048</span>, <span style="color:#a6e22e">pwd</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;gen pubKey and prvKey ok!&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;before encrypt: %s\n&#34;</span>, <span style="color:#a6e22e">sourceData</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用公钥加密</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">encryptData</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSAEncrypt</span>([]byte(<span style="color:#a6e22e">sourceData</span>), <span style="color:#a6e22e">pubKey</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after encrypt: %v\n&#34;</span>, <span style="color:#a6e22e">encryptData</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 使用私钥解密</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">decryptData</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RSADecryptWithPwd</span>(<span style="color:#a6e22e">encryptData</span>, <span style="color:#a6e22e">prvKey</span>, <span style="color:#a6e22e">pwd</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;after decrypt: %s\n&#34;</span>, string(<span style="color:#a6e22e">decryptData</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;equal? %v \n&#34;</span>, string(<span style="color:#a6e22e">decryptData</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">sourceData</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 输出</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gen</span> <span style="color:#a6e22e">pubKey</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">prvKey</span> <span style="color:#a6e22e">ok</span>!
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">before</span> <span style="color:#a6e22e">encrypt</span>: <span style="color:#a6e22e">好的代码本身就是最好的说明文档</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">after</span> <span style="color:#a6e22e">encrypt</span>: [<span style="color:#ae81ff">136</span> <span style="color:#ae81ff">134</span> <span style="color:#ae81ff">26</span> <span style="color:#ae81ff">233</span> <span style="color:#f92672">...</span>(<span style="color:#a6e22e">很长的字节数组</span>)]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">after</span> <span style="color:#a6e22e">decrypt</span>: <span style="color:#a6e22e">好的代码本身就是最好的说明文档</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">equal</span><span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#66d9ef">true</span>
</span></span></code></pre></div><h2 id="参考文章">参考文章：<a hidden class="anchor" aria-hidden="true" href="#参考文章">#</a></h2>
<ul>
<li><a href="https://studygolang.com/articles/22530">golang 使用 RSA 生成公私钥，加密，解密，并使用 SHA256 进行签名，验证</a></li>
<li><a href="https://wumansgy.github.io/2018/10/18/GO%E8%AF%AD%E8%A8%80RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/">GO 语言 RSA 加密解密</a></li>
<li><a href="https://www.coder.work/article/194272">go - 如何在 golang 中使用密码创建 rsa 私钥</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSA 算法原理（一）</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/golang/">Golang</a></li>
      <li><a href="http://localhost:1313/tags/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">加密算法</a></li>
      <li><a href="http://localhost:1313/tags/rsa/">RSA</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">hujm2023&#39;s blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
